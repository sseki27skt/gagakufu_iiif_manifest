# 旧字正規化機能の使い方

## 概要
雅楽譜検索システムでは、旧字（古い漢字）と新字（現代の漢字）の両方で検索できるように正規化機能を実装しています。

## 現在対応している旧字

| 旧字 | 新字 | 使用例 | データ内出現回数 |
|------|------|--------|------------------|
| 樂   | 楽   | 還城樂 → 還城楽 | 6箇所 |
| 龍   | 竜   | 龍笛 → 竜笛 | 111箇所 |

## 新しい旧字-新字ペアの追加方法

### 方法1: 設定ファイルを直接編集（推奨）

1. `docs/kanji-normalization-config.js` ファイルを開く
2. `KANJI_NORMALIZATION_CONFIG` オブジェクトに新しいペアを追加
3. ファイルを保存してページをリロード

```javascript
const KANJI_NORMALIZATION_CONFIG = {
    // 既存の設定
    '樂': '楽',
    '龍': '竜',
    
    // 新しく追加する場合
    '團': '団',        // 壱団嬌 → 壱団嬌
    '學': '学',        // 學校 → 学校
    '藝': '芸',        // 藝術 → 芸術
};
```

### 方法2: ブラウザコンソールで動的追加

1. ブラウザの開発者ツールを開く（F12キー）
2. コンソールタブを選択
3. 以下のコマンドを実行

```javascript
// 新しいペアを追加
addKanjiNormalization('團', '団');

// 現在の設定を確認
showKanjiNormalizationMap();
```

⚠️ **注意**: ブラウザコンソールでの追加は一時的です。永続化するには設定ファイルを編集してください。

## よく使用される旧字一覧（参考）

設定ファイルには、将来的に追加する可能性のある旧字がコメントアウトされて記載されています：

```javascript
// 一般的な旧字
// '團': '団',     // 壱団嬌 → 壱団嬌
// '學': '学',     // 學校 → 学校
// '藝': '芸',     // 藝術 → 芸術
// '國': '国',     // 國楽 → 国楽
// '變': '変',     // 變奏 → 変奏
// '聲': '声',     // 聲楽 → 声楽

// 数字関連
// '壹': '壱',     // 壹越調 → 壱越調
// '貳': '弐',     // 貳越調 → 弐越調
// '參': '参',     // 參越調 → 参越調
```

## 使用例

### 検索での利用
- 「竜笛」で検索 → 「龍笛」のデータも見つかる
- 「龍笛」で検索 → 元々通り「龍笛」のデータが見つかる
- 「還城楽」で検索 → 「還城樂」のデータが見つかる

### 設定確認
```javascript
// 現在の設定を表示
showKanjiNormalizationMap();

// 設定ファイルから直接確認
showConfig();
```

## トラブルシューティング

### 設定が反映されない場合
1. ブラウザのキャッシュをクリア
2. ページを強制リロード（Ctrl+F5 または Cmd+Shift+R）
3. 設定ファイルの構文エラーがないか確認

### 設定ファイルが読み込まれない場合
- HTMLファイルの`<head>`部分に以下が含まれているか確認：
```html
<script src="kanji-normalization-config.js"></script>
```

### ログ確認
ブラウザのコンソールで以下のようなメッセージが表示されます：
```
✅ 旧字正規化ペア追加: 團 → 団
💡 変更を永続化するには kanji-normalization-config.js を編集してください
```

## ファイル構成

```
docs/
├── index.html                      # メインの検索インターフェース
├── kanji-normalization-config.js   # 旧字正規化設定ファイル
└── pieces-index.json              # 楽曲データ
```

## 更新履歴

- 2025年7月15日: 旧字正規化機能の初期実装
  - 樂→楽、龍→竜 の2ペア対応
  - 設定ファイル分離
  - 動的追加機能実装
